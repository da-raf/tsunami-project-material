<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>SWE: SWE_WavePropagationBlockCuda Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">SWE
   
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a>  </div>
  <div class="headertitle">
<div class="title">SWE_WavePropagationBlockCuda Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="SWE_WavePropagationBlockCuda" --><!-- doxytag: inherits="SWE_BlockCUDA" -->
<p><code>#include &lt;<a class="el" href="SWE__WavePropagationBlockCuda_8hh_source.html">SWE_WavePropagationBlockCuda.hh</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for SWE_WavePropagationBlockCuda:</div>
<div class="dyncontent">
 <div class="center">
  <img src="classSWE__WavePropagationBlockCuda.png" usemap="#SWE_WavePropagationBlockCuda_map" alt=""/>
  <map id="SWE_WavePropagationBlockCuda_map" name="SWE_WavePropagationBlockCuda_map">
<area href="classSWE__BlockCUDA.html" alt="SWE_BlockCUDA" shape="rect" coords="0,56,207,80"/>
<area href="classSWE__Block.html" alt="SWE_Block" shape="rect" coords="0,0,207,24"/>
</map>
 </div></div>

<p><a href="classSWE__WavePropagationBlockCuda-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSWE__WavePropagationBlockCuda.html#a82f9de16ebab1bff58ead034416ab9ef">SWE_WavePropagationBlockCuda</a> (int l_nx, int l_ny, float l_dx, float l_dy)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSWE__WavePropagationBlockCuda.html#ab4ad10c9704b7f5501f2a1d828672b57">~SWE_WavePropagationBlockCuda</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSWE__WavePropagationBlockCuda.html#ab401d17ea7a60ff30219076bc85dc591">simulateTimestep</a> (float i_dT)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSWE__WavePropagationBlockCuda.html#a8c0fbb70ad29f3775d35978bf2d5b396">simulate</a> (float, float)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSWE__WavePropagationBlockCuda.html#a8a89bf61b9fc4433652f400ca8e564ed">computeNumericalFluxes</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classSWE__WavePropagationBlockCuda.html#a4163045a47a73515841e754ca3859fc5">updateUnknowns</a> (const float i_deltaT)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p><a class="el" href="classSWE__WavePropagationBlockCuda.html">SWE_WavePropagationBlockCuda</a> is an implementation of the SWE_BlockCuda abstract class. It uses a wave propagation solver which is defined with the pre-compiler flag WAVE_PROPAGATION_SOLVER (see above).</p>
<p>Possible wave propagation solvers are: F-Wave, &lt;strike&gt;Approximate Augmented Riemann, Hybrid (f-wave + augmented).&lt;/strike&gt; (details can be found in the corresponding source files) </p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="a82f9de16ebab1bff58ead034416ab9ef"></a><!-- doxytag: member="SWE_WavePropagationBlockCuda::SWE_WavePropagationBlockCuda" ref="a82f9de16ebab1bff58ead034416ab9ef" args="(int l_nx, int l_ny, float l_dx, float l_dy)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classSWE__WavePropagationBlockCuda.html#a82f9de16ebab1bff58ead034416ab9ef">SWE_WavePropagationBlockCuda::SWE_WavePropagationBlockCuda</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>l_nx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>l_ny</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>l_dx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>l_dy</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Constructor of a <a class="el" href="classSWE__WavePropagationBlockCuda.html">SWE_WavePropagationBlockCuda</a>.</p>
<p>Allocates the variables for the simulation: Please note: The definition of indices changed in contrast to the CPU-Implementation.</p>
<p>unknowns hd,hud,hvd,bd stored on the CUDA device are defined for grid indices [0,..,nx+1]*[0,..,ny+1] (-&gt; Abstract class <a class="el" href="classSWE__BlockCUDA.html">SWE_BlockCUDA</a>) -&gt; computational domain is [1,..,nx]*[1,..,ny] -&gt; plus ghost cell layer</p>
<p>net-updates are defined for edges with indices [0,..,nx]*[0,..,ny] for horizontal and vertical edges for simplicity (one layer is not necessary).</p>
<p>A left/right net update with index (i-1,j) is located on the edge between cells with index (i-1,j) and (i,j): </p>
<pre>
   *********************
   *         *         *
   * (i-1,j) *  (i,j)  *
   *         *         *
   *********************</pre><pre>             *
            ***
           *****
             *
             *
   NetUpdatesLeft(i-1,j)
             or
   NetUpdatesRight(i-1,j)
 </pre><p>A below/above net update with index (i, j-1) is located on the edge between cells with index (i, j-1) and (i,j): </p>
<pre>
   ***********
   *         *
   * (i, j)  *   *
   *         *  **  NetUpdatesBelow(i,j-1)
   *********** *****         or
   *         *  **  NetUpdatesAbove(i,j-1)
   * (i,j-1) *   *
   *         *
   ***********
 </pre> <dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">i_offsetX</td><td>spatial offset of the block in x-direction. </td></tr>
    <tr><td class="paramname">i_offsetY</td><td>spatial offset of the offset in y-direction. </td></tr>
    <tr><td class="paramname">i_cudaDevice</td><td>ID of the CUDA-device, which should be used. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ab4ad10c9704b7f5501f2a1d828672b57"></a><!-- doxytag: member="SWE_WavePropagationBlockCuda::~SWE_WavePropagationBlockCuda" ref="ab4ad10c9704b7f5501f2a1d828672b57" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classSWE__WavePropagationBlockCuda.html#ab4ad10c9704b7f5501f2a1d828672b57">SWE_WavePropagationBlockCuda::~SWE_WavePropagationBlockCuda</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Destructor of a <a class="el" href="classSWE__WavePropagationBlockCuda.html">SWE_WavePropagationBlockCuda</a>.</p>
<p>Frees all of the memory, which was allocated within the constructor. Resets the CUDA device: Useful if error occured and printf is used on the device (buffer). </p>

</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a8a89bf61b9fc4433652f400ca8e564ed"></a><!-- doxytag: member="SWE_WavePropagationBlockCuda::computeNumericalFluxes" ref="a8a89bf61b9fc4433652f400ca8e564ed" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classSWE__WavePropagationBlockCuda.html#a8a89bf61b9fc4433652f400ca8e564ed">SWE_WavePropagationBlockCuda::computeNumericalFluxes</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Compute the numerical fluxes (net-update formulation here) on all edges.</p>
<p>The maximum wave speed is computed within the net-updates kernel for each CUDA-block. To finalize the method the Thrust-library is called, which does the reduction over all blockwise maxima. In the wave speed reduction step the actual cell width in x- and y-direction is not taken into account.</p>
<p>TODO: A splitting or direct computation of the time step width might increase the total time step size. Example: dx = 11, dy = 6; max wave speed in x-direction: 10 max wave speed in y-direction: 5.5 max wave speed in both direction: 10</p>
<p>=&gt; maximum time step (current implementation): min(11/10, 6/10) = 0.6 =&gt; maximum time step (splitting the dimensions): min(11/10, 6/5.5) = 1.09.. </p>
<p><b>Row-major vs column-major</b></p>
<p>C/C++ arrays are row-major whereas warps are constructed in column-major order from threads/blocks. To get coalesced memory access in CUDA, we can use a 2-dimensional CUDA structure but we have to switch x and y inside a block.</p>
<p>This means, we have to switch threadIdx.x &lt;-&gt; threadIdx.y as well as blockDim.x &lt;-&gt; blockDim.y. Important: blockDim has to be switched for the kernel call as well!</p>
<p>definition of one CUDA-block. Typical size are 8*8 or 16*16</p>
<p>Definition of the "main" CUDA-grid. This grid covers only edges 0..#(edges in x-direction)-2 and 0..#(edges in y-direction)-2.</p>
<p>An example with a computational domain of size nx = 24, ny = 16 with a 1 cell ghost layer would result in a grid with (nx+2)*(ny+2) = (26*18) cells and (nx+1)*(ny+1) = (25*17) edges.</p>
<p>The CUDA-blocks (here 8*8) mentioned above would cover all edges except the ones lying between the computational domain and the right/top ghost layer: </p>
<pre>
                                                          *
                                                         **        top ghost layer,
                                                        ********   cell ids
                        *******************************  **        = (*, ny+1)
                        *         *         *         *   *
                        *   8*8   *   8*8   *   8*8   *
                        *  block  *  block  *  block  *
                        *         *         *         *
                        *******************************
                        *         *         *         *
                        *   8*8   *   8*8   *   8*8   *
                    *   *  block  *  block  *  block  *
     bottom         **  *         *         *         *
     ghost     ******** *******************************
     layer,         **
     cell ids       *   *                              *
     =(*,0)            ***                            ***
                        *                              *
                        *                              *
                  left ghost layer,             right ghost layer,
                  cell ids = (0,*)             cell ids = (nx+1, *)
 </pre>
<p>Implements <a class="el" href="classSWE__Block.html#a94dcf2c6ae31731e4586e45628b0c00e">SWE_Block</a>.</p>

</div>
</div>
<a class="anchor" id="a8c0fbb70ad29f3775d35978bf2d5b396"></a><!-- doxytag: member="SWE_WavePropagationBlockCuda::simulate" ref="a8c0fbb70ad29f3775d35978bf2d5b396" args="(float, float)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__host__ float <a class="el" href="classSWE__WavePropagationBlockCuda.html#a8c0fbb70ad29f3775d35978bf2d5b396">SWE_WavePropagationBlockCuda::simulate</a> </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>tStart</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>tEnd</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>perform forward-Euler time steps, starting with simulation time tStart,: until simulation time tEnd is reached; device-global variables hd, hud, hvd are updated; unknowns h, hu, hv in main memory are not updated. Ghost layers and bathymetry sources are updated between timesteps. intended as main simulation loop between two checkpoints </p>

<p>Implements <a class="el" href="classSWE__Block.html#a1da88bb47008dc9246a8c47d00575d1e">SWE_Block</a>.</p>

</div>
</div>
<a class="anchor" id="ab401d17ea7a60ff30219076bc85dc591"></a><!-- doxytag: member="SWE_WavePropagationBlockCuda::simulateTimestep" ref="ab401d17ea7a60ff30219076bc85dc591" args="(float i_dT)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">__host__ void <a class="el" href="classSWE__WavePropagationBlockCuda.html#ab401d17ea7a60ff30219076bc85dc591">SWE_WavePropagationBlockCuda::simulateTimestep</a> </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>i_dT</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Compute a single global time step of a given time step width. Remark: The user has to take care about the time step width. No additional check is done. The time step width typically available after the computation of the numerical fluxes (hidden in this method).</p>
<p>First the net-updates are computed. Then the cells are updated with the net-updates and the given time step width.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">i_dT</td><td>time step width in seconds. </td></tr>
  </table>
  </dd>
</dl>

<p>Implements <a class="el" href="classSWE__Block.html#a4fb41f3bbbda88992e5bce802e139c9b">SWE_Block</a>.</p>

</div>
</div>
<a class="anchor" id="a4163045a47a73515841e754ca3859fc5"></a><!-- doxytag: member="SWE_WavePropagationBlockCuda::updateUnknowns" ref="a4163045a47a73515841e754ca3859fc5" args="(const float i_deltaT)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="classSWE__WavePropagationBlockCuda.html#a4163045a47a73515841e754ca3859fc5">SWE_WavePropagationBlockCuda::updateUnknowns</a> </td>
          <td>(</td>
          <td class="paramtype">const float&#160;</td>
          <td class="paramname"><em>i_deltaT</em></td><td>)</td>
          <td><code> [virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Update the cells with a given global time step.</p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">i_deltaT</td><td>time step size. </td></tr>
  </table>
  </dd>
</dl>
<p>definition of one CUDA-block. Typical size are 8*8 or 16*16</p>
<p>definition of the CUDA-grid. </p>

<p>Implements <a class="el" href="classSWE__Block.html#ab2b4b659f23d5d45413dece8d2da3298">SWE_Block</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>/home/thomas/Dokumente/SWE/src/blocks/cuda/<a class="el" href="SWE__WavePropagationBlockCuda_8hh_source.html">SWE_WavePropagationBlockCuda.hh</a></li>
<li>/home/thomas/Dokumente/SWE/src/blocks/cuda/<a class="el" href="SWE__WavePropagationBlockCuda_8cu.html">SWE_WavePropagationBlockCuda.cu</a></li>
</ul>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Mon May 13 2013 03:39:43 for SWE by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
